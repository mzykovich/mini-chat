<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Corp Chat Template</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>

<!-- Login Screen -->
<div id="loginScreen" class="login-screen hidden screen is-hidden">
  <div class="login-card">
    <div class="logo-container">
      <img src="/logo.png" alt="anrex" class="login-logo">
      <div class="muted" style="margin-top:5px; font-size:12px;">Нужно войти</div>
    </div>

    <div class="tabs" style="justify-content:center; margin-bottom:20px;">
      <div id="tabLogin" class="tab active">Вход</div>
      <div id="tabRegister" class="tab">Регистрация</div>
    </div>

    <div id="loginForm">
      <div class="row" style="margin-top:0;">
        <input id="loginEmail" placeholder="Email" />
      </div>
      <div class="row">
        <input id="loginPass" placeholder="Пароль" type="password" />
      </div>
      <div style="margin-top:20px;" class="row">
        <button id="loginBtn" class="primary-btn" style="display:block; margin:0 auto;">Войти</button>
      </div>
      <div class="muted" id="loginMsg" style="text-align:center; margin-top:10px;"></div>
    </div>

    <div id="registerForm" class="hidden">
      <div class="row" style="margin-top:0;">
        <input id="regName" placeholder="Имя (как будет видно в чате)" />
      </div>
      <div class="row">
        <input id="regEmail" placeholder="Email" />
      </div>
      <div class="row">
        <input id="regPass" placeholder="Пароль (мин 6 символов)" type="password" />
      </div>
      <div class="row">
        <input id="regInvite" placeholder="Инвайт-код (обязателен)" />
      </div>
      <div class="row">
        <select id="regPosition"></select>
      </div>
      <div class="row">
        <button id="registerBtn" class="primary-btn" style="width:100%">Зарегистрироваться</button>
      </div>
      <div class="muted" id="registerMsg" style="text-align:center; margin-top:10px;"></div>
    </div>
  </div>
</div>

<!-- Main App Interface -->
<div id="appInterface" class="app hidden screen is-hidden">
  <div class="side">
    <div class="sidebar-top">
      <div class="sidebar-brand">
        <div class="sidebar-brand-left">
          <img src="/logo.png" alt="logo" class="chat-logo">
          <div class="sidebar-brand-text">
            <div class="muted" id="status">Проверка сессии…</div>
          </div>
        </div>
      </div>

      <div class="tabs sidebar-modes" id="sidebarModes">
        <div id="sidebarModeWork" class="tab active" data-sidebar-mode="work">
          <span class="tab-icon" aria-hidden="true">
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-briefcase-business-icon lucide-briefcase-business"><path d="M12 12h.01"/><path d="M16 6V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/><path d="M22 13a18.15 18.15 0 0 1-20 0"/><rect width="20" height="14" x="2" y="6" rx="2"/></svg>
          </span>
          <span class="tab-label">Работа</span>
        </div>
        <div id="sidebarModePersonal" class="tab" data-sidebar-mode="personal">
          <span class="tab-icon" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle-icon lucide-message-circle"><path d="M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719"/></svg>
          </span>
          <span class="tab-label">Личное</span>
        </div>
      </div>
    </div>

    <div class="sidebar-scroll">
      <div id="channelsCard" class="sidebar-section">
        <div class="sidebar-section-header">
          <div style="margin-top:5px;" class="sidebar-section-title">Каналы</div>
          
        </div>
        <div class="row sidebar-search-row">
          <input id="channelsSearch" class="search" placeholder="Поиск канала…" />
        </div>
        <div class="list" id="channels"></div>
        <div class="muted sidebar-section-hint">В списке только доступные тебе каналы</div>
      </div>

      <div id="peopleCard" class="sidebar-section">
        <div class="sidebar-section-header">
          <div class="sidebar-section-title">Сотрудники</div>
          <button id="refreshPeopleBtn" class="icon-btn" aria-label="Обновить сотрудников" title="Обновить">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-ccw-icon lucide-refresh-ccw"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>
          </button>
        </div>
        <div class="row sidebar-search-row">
          <input id="peopleSearch" class="search" placeholder="Поиск по имени/email…" />
        </div>
        <div class="list" id="peopleList"></div>
        <div class="muted sidebar-section-hint">Нажми на сотрудника — откроется DM</div>
      </div>

      <div id="dmCard" class="sidebar-section">
        <div class="sidebar-section-header">
          <div class="sidebar-section-title">Личные сообщения</div>
          <button id="newDmBtn" class="icon-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle-plus-icon lucide-message-circle-plus"><path d="M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>
          </button>
        </div>
        <div class="row sidebar-search-row">
          <input id="dmSearch" class="search" placeholder="Поиск по имени/email…" />
        </div>
        <div class="row hidden" id="dmPickerRow">
          <div class="multi-picker">
            <input id="dmUserPickInput" class="multi-picker-input" type="text" readonly value="Выбери пользователя…" />
            <div id="dmUserPickMenu" class="multi-picker-menu hidden">
              <div class="multi-picker-search-wrap">
                <input id="dmUserPickSearch" class="multi-picker-search" placeholder="Поиск пользователя…" />
              </div>
              <div id="dmUserPickList" class="multi-picker-list"></div>
            </div>
          </div>
          <select id="dmUserSelect" class="hidden"></select>
          <button style="margin-bottom:10px;" id="dmOpenBtn">Открыть</button>
        </div>
        <div class="list" id="dmList"></div>
        <div class="muted sidebar-section-hint">DM доступны только между пользователями этого сервера</div>
      </div>
    </div>

    <div class="sidebar-footer">
      <div id="meBox" class="hidden">
        <div class="sidebar-me">
          <div class="sidebar-me-text">
            <div><b id="meName"></b> <span class="pill" id="meRole"></span></div>
            <div class="muted" id="meEmail"></div>
          </div>
          <div style="display:flex; gap:10px;">
          <button id="openAdminBtn" class="hidden icon-btn" aria-label="Админка" title="Админка">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings2-icon lucide-settings-2"><path d="M14 17H5"/><path d="M19 7h-9"/><circle cx="17" cy="17" r="3"/><circle cx="7" cy="7" r="3"/></svg>
          </button>
          <button id="logoutBtn" class="hidden icon-btn" aria-label="Выйти" title="Выйти">
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out-icon lucide-log-out"><path d="m16 17 5-5-5-5"/><path d="M21 12H9"/><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/></svg>
          </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="main">
    <div class="card">
      <div class="chat-header">
        <button id="mobileBackBtn" class="icon-btn chat-back-btn" aria-label="Назад" title="Назад">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left-icon lucide-arrow-left">
            <path d="m12 19-7-7 7-7"/>
            <path d="M19 12H5"/>
          </svg>
        </button>
        <div class="chat-header-text">
          <div><b id="title">—</b></div>
          <div class="muted" id="hint">Сначала войди/зарегистрируйся</div>
        </div>
      </div>
    </div>

    <div id="attachPreview" class="card hidden" style="margin-top:10px;">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
        <div class="truncate" id="attachPreviewText"></div>
        <button id="attachRemoveBtn" class="danger">Убрать</button>
      </div>
    </div>

    <div id="log"></div>

    <div class="row">
      <input id="text" placeholder="Написать сообщение…" maxlength="2000" disabled />
      <input id="file" type="file" class="hidden" />
      <button id="fileBtn" disabled>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-paperclip-icon lucide-paperclip"><path d="m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551"/></svg>
      </button>
      <button id="send" disabled>
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send-icon lucide-send"><path d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"/><path d="m21.854 2.147-10.94 10.939"/></svg>
      </button>
    </div>
  </div>

  <div class="right-sidebar hidden"></div>
</div>

<!-- Admin Modal -->
<div id="adminModal" class="modal-overlay hidden is-hidden">
  <div class="modal-content">
    
    <!-- Left Sidebar -->
    <div class="modal-sidebar">
      <div class="tabs">
        <div class="tab active" data-admin-tab="roles">Роли</div>
        <div class="tab" data-admin-tab="users">Пользователи</div>
        <div class="tab" data-admin-tab="channels">Каналы</div>
        <div class="tab" data-admin-tab="audit">Аудит</div>
        <div class="tab" data-admin-tab="dms">DM аудит</div>
        <div class="tab hidden" id="adminSettingsTab" data-admin-tab="settings">Настройки</div>
        <div class="tab" data-admin-tab="invites">Инвайты</div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="modal-main">
      <div class="modal-header-right">
        <h2>Админ-панель</h2>
        <button style="border:none; background:transparent;" id="closeAdminBtn" class="modal-close-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-icon lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      </div>

      <div class="modal-body-content">
        
        <div id="adminRoles">
          <div class="muted">Кастомные роли (должности).</div>
          <div class="row">
            <input id="newRoleName" placeholder="role-slug (например sales-manager)" />
          </div>
          <div class="row">
            <input id="newRoleDisplay" placeholder="Отображаемое имя (например Менеджер)" />
            <button id="createRoleBtn" class="primary">Создать</button>
          </div>
          <div class="hr"></div>
          <div id="rolesList" class="muted"></div>
        </div>

        <div id="adminUsers" class="hidden">
          <div class="muted">Выдавай и снимай роли.</div>
          <div style="margin-top:12px;">
            <div class="muted">Сотрудник</div>
            <div class="multi-picker">
              <input id="adminUserPickInput" class="multi-picker-input" type="text" readonly value="Выбери сотрудника…" />
              <div id="adminUserPickMenu" class="multi-picker-menu hidden">
                <div class="multi-picker-search-wrap">
                  <input id="adminUserPickSearch" class="multi-picker-search" placeholder="Поиск сотрудника…" />
                </div>
                <div id="adminUserPickList" class="multi-picker-list"></div>
              </div>
            </div>
          </div>
          <div class="hr"></div>
          <div id="usersList"></div>
        </div>

        <div id="adminChannels" class="hidden">
          <div class="muted" style="margin-bottom:10px;">Управление каналами</div>
          
          <!-- Create Channel Section -->
          <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 5px;">
             <div class="muted" style="margin-bottom:5px;">Создать новый канал:</div>
             <div class="row" style="margin-top:0;">
                <input id="newChannelName" placeholder="channel-name" />
                <select id="newChannelPublic" style="width:auto;">
                  <option value="true">Публичный</option>
                  <option value="false">Приватный</option>
                </select>
                <button id="createChannelBtn" class="primary">Создать</button>
             </div>
          </div>

          <div class="hr"></div>

          <!-- Edit Channel Selector -->
           <div class="muted" style="margin-bottom:5px;">Редактирование канала:</div>
           <div class="row" style="margin-top:0;">
             <select id="accessChannel" style="padding: 12px; font-size: 16px;"></select>
             <button id="loadAccessBtn" class="hidden">Обновить</button> <!-- Hidden as onchange handles it usually -->
           </div>

          <div style="margin-top: 20px; border: 1px solid #4f545c; padding: 15px; border-radius: 5px;">
            <div class="muted">Свойства выбранного канала:</div>
            <div class="row">
              <input id="editChannelName" placeholder="Название канала" />
            </div>
            <div class="row">
              <select id="editChannelPrivacy">
                <option value="true">Публичный (всем)</option>
                <option value="false">Приватный (по доступу)</option>
              </select>
              <button id="saveChannelPropsBtn" class="primary">Сохранить</button>
              <button id="deleteChannelBtn" class="danger">Удалить</button>
            </div>
            <div class="muted" id="channelPropsMsg" style="margin-top:5px;"></div>
          </div>

          <div class="hr"></div>

          <div class="muted">Настройка доступа (для приватных каналов):</div>
          
          <div style="margin-top:15px;">
            <div class="muted">Роли с доступом</div>
            <div class="multi-picker">
              <input id="accessRolesInput" class="multi-picker-input" type="text" readonly value="Выбрано: 0" />
              <div id="accessRolesMenu" class="multi-picker-menu hidden">
                <div class="multi-picker-search-wrap">
                  <input id="accessRolesSearch" class="multi-picker-search" placeholder="Поиск роли…" />
                </div>
                <div id="accessRoles" class="multi-picker-list"></div>
              </div>
            </div>
          </div>
          
          <div style="margin-top:20px;">
            <div class="muted">Пользователи с доступом</div>
            <div class="multi-picker">
              <input id="accessUsersInput" class="multi-picker-input" type="text" readonly value="Выбрано: 0" />
              <div id="accessUsersMenu" class="multi-picker-menu hidden">
                <div class="multi-picker-search-wrap">
                  <input id="accessUsersSearch" class="multi-picker-search" placeholder="Поиск пользователя…" />
                </div>
                <div id="accessUsers" class="multi-picker-list"></div>
              </div>
            </div>
          </div>

          <div class="row" style="margin-top:20px;">
            <button id="saveAccessBtn" class="primary">Сохранить доступ</button>
          </div>
          <div class="muted" id="accessMsg" style="margin-top:5px;"></div>
        </div>

        <div id="adminAudit" class="hidden">
          <div class="muted">Журнал действий (OWNER/SUPERADMIN).</div>
          <div class="hr"></div>
          <div id="auditList" class="muted"></div>
        </div>

        <div id="adminSettings" class="hidden">
          <div class="muted">Настройки загрузок (только SUPERADMIN).</div>
          <div class="hr"></div>
          <div class="row">
            <input id="maxFileMb" placeholder="Макс. размер файла (MB)" />
            <button id="saveMaxFileBtn" class="primary">Сохранить</button>
          </div>
          <div class="muted" id="settingsMsg"></div>
        </div>

        <div id="adminDms" class="hidden">
          <div class="muted">Просмотр личных сообщений (OWNER/SUPERADMIN). Каждый просмотр логируется в аудит.</div>
          <div class="hr"></div>
          <div class="row">
            <select id="dmAuditSelect"></select>
            <button id="dmAuditLoadBtn" class="primary">Открыть</button>
          </div>
          <div id="dmAuditLog" class="small" style="margin-top:10px;"></div>
          <div class="hr"></div>
          <div id="dmAuditMessages"></div>
        </div>

        <div id="adminInvites" class="hidden">
          <div class="muted">Инвайты для регистрации (ADMIN/OWNER). Регистрация без инвайта доступна только первому пользователю (OWNER).</div>
          <div class="hr"></div>

          <div class="row">
            <input id="inviteMaxUses" placeholder="Макс. использований (например 1)" />
            <input id="inviteExpiresHours" placeholder="Срок (часов, 0 = без срока)" />
            <button id="inviteCreateBtn" class="primary">Создать инвайт</button>
          </div>
          <div class="row" style="flex-wrap:wrap; gap:8px;">
            <button id="inviteQuick1">Быстрый: 1 раз</button>
            <button id="inviteQuick24">Быстрый: 1 раз / 24ч</button>
            <button id="inviteQuick10">Быстрый: 10 раз</button>
          </div>
          <div class="muted" id="inviteMsg" style="margin-top:10px;"></div>

          <div class="hr"></div>
          <div id="invitesList" class="small"></div>
        </div>
        
      </div>
    </div>
  </div>
</div>
<script src="/app.js" defer></script>
</body>
</html>
